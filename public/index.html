<!DOCTYPE html>
<html>
<head>
  <title>YouTube â†’ MP3</title>
  <style>
    body { font-family: Arial; background:#eee; display:flex; justify-content:center; }
    .box { background:#fff; padding:20px; margin-top:50px; width:300px; text-align:center; border-radius:8px; }
    img { width:200px; border-radius:6px }
    progress { width:100%; }
  </style>
</head>
<body>

<div class="box">
  <input id="url" placeholder="YouTube URL" style="width:100%"><br><br>
  <button id="downloadBtn">Download</button>

  <div id="preview" style="display:none">
    <img id="cover"><br>
    <b id="title"></b><br>
    <span id="artist"></span><br><br>
    <button id="confirm">Confirm</button>
  </div>

  <div id="progressBox" style="display:none">
    <progress id="bar" max="100"></progress>
    <div id="text"></div>
  </div>
</div>

<script>
let currentUrl = "";

document.getElementById("downloadBtn").onclick = async () => {
  currentUrl = document.getElementById("url").value;
  const r = await fetch("/preview", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ youtubeUrl: currentUrl })
  });
  const d = await r.json();
  document.getElementById("cover").src = d.cover;
  document.getElementById("title").textContent = d.title;
  document.getElementById("artist").textContent = d.artist;
  document.getElementById("preview").style.display = "block";
};

document.getElementById("confirm").onclick = () => {
  document.getElementById("preview").style.display = "none";
  document.getElementById("progressBox").style.display = "block";

  const es = new EventSource("/progress");
  es.onmessage = e => {
    const d = JSON.parse(e.data);
    document.getElementById("bar").value = d.percent;
    document.getElementById("text").textContent = d.message;
  };

  const form = document.createElement("form");
  form.method = "POST";
  form.action = "/download";
  const i = document.createElement("input");
  i.name = "youtubeUrl";
  i.value = currentUrl;
  form.appendChild(i);
  document.body.appendChild(form);
  form.submit();
};
</script>

</body>
</html>
